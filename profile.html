<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Your Preliminary Wellness Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --brand-accent: #debea9;
            --brand-dark-text: #3c3b31; 
        }
        
        html, body { 
            overscroll-behavior: none; 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(120deg, #fdfcfb, #f9f7f5, #f5f2ef, #f9f7f5, #fdfcfb);
            background-size: 400% 400%;
            animation: moveBackground 40s ease infinite;
        }

        @keyframes moveBackground {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .content-card {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.07);
        }
        
        .cta-button {
            background-color: var(--brand-dark-text);
            color: white;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 15px rgba(60, 59, 49, 0.2);
        }
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(60, 59, 49, 0.3);
        }

        .highlight-stat {
            background-color: #ffffff;
            border-radius: 1.25rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .highlight-stat .value {
            font-weight: 900;
            font-size: 4rem;
            line-height: 1;
            color: var(--brand-dark-text);
        }
        
        .highlight-stat .label {
            font-weight: 600;
            color: #78716c; /* stone-500 */
            margin-top: 0.5rem;
        }

        .bio-age {
            background: linear-gradient(to right, #cdaa8d, #b69882);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .factor-list li {
            background-color: #f9fafb;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 1px solid #f3f4f6;
            display: flex;
            align-items: flex-start;
        }

        #loading-overlay { transition: opacity 0.5s ease-out; }
        
        /* BMI Widget Styles - Matched with quiz-new.html */
        #bmi-scale-container {
            position: relative;
            width: 32px;
            height: 100%;
        }
        #bmi-scale-gradient-vertical {
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, #43B7FF, #33C75A, #FBF447, #FFA64D, #FF7D7E);
            border-radius: 100px;
            position: absolute;
        }
        #bmi-thumb {
            position: absolute; width: 40px; height: 40px;
            background: linear-gradient(180deg, #F2F2F2 0%, #E8E8E8 100%);
            border: 2px solid #FFFFFF; box-shadow: 0px 0px 6.9px rgba(0, 0, 0, 0.25);
            border-radius: 50%; left: 50%; transform: translateX(-50%);
            bottom: 0%; 
            transition: bottom 1.5s cubic-bezier(0.22, 1, 0.36, 1); 
            z-index: 1;
        }
        #bmi-image-section {
            display: flex;
            align-items: flex-end;
            height: 100%;
            flex-grow: 1;
            justify-content: center;
        }
        #bmi-image {
            height: 100%; width: auto; object-fit: contain;
            user-select: none; pointer-events: none;
        }

        /* Scroll Animations */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 0.8s cubic-bezier(0.165, 0.84, 0.44, 1), transform 0.8s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .animate-on-scroll.delay-1 { transition-delay: 150ms; }
        .animate-on-scroll.delay-2 { transition-delay: 300ms; }

        /* --- –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –°–õ–ê–ô–î–ï–†–ê –û–¢–ó–´–í–û–í --- */
        #testimonial-slider-wrapper {
            /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* IE and Edge */
        }
        #testimonial-slider-wrapper::-webkit-scrollbar {
            display: none; /* Chrome, Safari, and Opera */
        }
        .testimonial-slide {
            flex: 0 0 100%; /* –ö–∞–∂–¥—ã–π —Å–ª–∞–π–¥ –∑–∞–Ω–∏–º–∞–µ—Ç 100% —à–∏—Ä–∏–Ω—ã */
            width: 100%;
            box-sizing: border-box;
            padding: 0 8px; /* –ù–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –ø–æ –±–æ–∫–∞–º */
            scroll-snap-align: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–ª–∞–π–¥ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        }
        
        .star-rating svg { color: #f59e0b; }
        .slider-dots { display: flex; justify-content: center; gap: 0.5rem; margin-top: 1rem; }
        .slider-dot { width: 0.5rem; height: 0.5rem; background-color: #d1d5db; border-radius: 9999px; cursor: pointer; transition: background-color 0.3s; }
        .slider-dot.active { background-color: var(--brand-dark-text); }
        
        /* Animation for CTA button */
        @keyframes pulsate {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 8px 25px rgba(60, 59, 49, 0.3);
            }
            50% {
                transform: scale(1.03);
                box-shadow: 0 12px 35px rgba(60, 59, 49, 0.4);
            }
        }
        .pulsating {
            animation: pulsate 2.5s infinite ease-in-out;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–∂–∏ */
        .skin-metric-label {
            color: #57534e; /* stone-600 */
            font-weight: 500;
        }
        .progress-bar-bg {
            background-color: #f5f5f4; /* stone-100 */
            border-radius: 9999px;
            height: 8px;
            width: 100%;
            overflow: hidden;
        }
        .progress-bar-fg {
            height: 100%;
            border-radius: 9999px;
            transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1);
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div id="loading-overlay" class="fixed inset-0 bg-white/80 backdrop-blur-sm z-50 flex flex-col items-center justify-center">
        <div class="w-16 h-16 border-4 border-gray-300 border-t-[--brand-accent] rounded-full animate-spin"></div>
        <p id="loading-text" class="mt-4 text-lg font-semibold text-gray-700">Preparing your profile...</p>
    </div>

    <div id="profile-content" class="min-h-screen p-4 sm:p-6 lg:p-8 opacity-0 transition-opacity duration-500">
        <header class="max-w-5xl mx-auto mb-8 text-center animate-on-scroll">
            <img src="logo.png" alt="Logo" class="h-12 w-auto mx-auto">
            <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight mt-4">Your Preliminary Wellness Profile</h1>
            <p class="mt-2 text-lg text-gray-600">Based on your answers, we've calculated your key metrics.</p>
        </header>

        <main class="max-w-5xl mx-auto space-y-8 sm:space-y-12">
            
            <section id="photo-and-skin-section" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div id="user-photo-container" class="md:col-span-1 animate-on-scroll">
                    <div class="max-w-[10rem] mx-auto md:max-w-full">
                        <img id="user-photo" src="https://placehold.co/400x533/f5f2ef/3c3b31?text=Your+Photo" alt="User Photo" class="w-full h-auto object-cover rounded-2xl shadow-lg">
                    </div>
                </div>
                <div id="skin-analysis-container" class="md:col-span-2 content-card p-6 animate-on-scroll delay-1">
                    <h3 class="text-xl font-bold mb-4" style="color: var(--brand-dark-text);">Skin Analysis</h3>
                    <ul id="skin-analysis-list" class="space-y-3">
                    </ul>
                </div>
            </section>

            <section id="user-stats-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
                <div class="highlight-stat animate-on-scroll">
                    <p id="chrono-age" class="value">0</p>
                    <p class="label">Chronological Age</p>
                </div>
                <div class="highlight-stat animate-on-scroll delay-1">
                    <p id="bio-age" class="value bio-age">0</p>
                    <p class="label">Biological Age</p>
                </div>
                <div id="bmi-widget-container" class="md:col-span-2 content-card p-6 flex flex-col items-center animate-on-scroll delay-2">
                    <div class="text-center">
                        <p id="bmi-value" class="text-3xl font-extrabold" style="color: var(--brand-dark-text);"></p>
                        <p id="bmi-category" class="font-bold text-lg text-green-600 -mt-1"></p>
                    </div>
                    <p id="bmi-description" class="text-sm text-gray-600 mt-2 text-center max-w-xs"></p>
                    <div class="w-full flex items-center justify-center gap-6 mt-2 flex-grow h-48 sm:h-56">
                        <div id="bmi-scale-container">
                            <div id="bmi-scale-gradient-vertical"></div>
                            <div id="bmi-thumb"></div>
                        </div>
                        <div id="bmi-image-section">
                            <img id="bmi-image" src="" alt="BMI illustration">
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="age-summary-card" class="content-card p-6 text-center animate-on-scroll">
                <p id="age-summary-text" class="text-2xl font-bold"></p>
            </section>
            
            <section class="grid md:grid-cols-2 gap-6">
                <div class="content-card p-6 text-center animate-on-scroll">
                    <p class="font-semibold text-gray-600">Your Wellness Archetype</p>
                    <p id="archetype-name" class="text-3xl font-extrabold mt-2" style="color: var(--brand-dark-text);">The Driven Achiever</p>
                    <p id="archetype-desc" class="mt-2 text-gray-700">You excel at work and stay active, but high stress and lack of sleep are holding you back from your full potential.</p>
                </div>
                 <div class="content-card p-6 text-center bg-yellow-50 border-yellow-200 animate-on-scroll delay-1">
                    <p class="font-semibold text-yellow-800">Your Key Focus Area</p>
                    <p id="focus-area-name" class="text-3xl font-extrabold text-yellow-900 mt-2">Stress Management</p>
                    <p id="focus-area-desc" class="mt-2 text-yellow-800">Lowering your stress is the single most effective way to improve your biological age and overall well-being.</p>
                </div>
            </section>

            <section class="grid md:grid-cols-2 gap-6">
                <div class="content-card p-6 animate-on-scroll">
                    <h3 class="text-xl font-bold flex items-center"><span class="text-2xl mr-2">‚ùå</span>What's Increasing Your Age</h3>
                    <ul id="negative-factors" class="mt-4 space-y-3 factor-list"></ul>
                </div>
                <div class="content-card p-6 animate-on-scroll delay-1">
                    <h3 class="text-xl font-bold flex items-center"><span class="text-2xl mr-2">‚úÖ</span>What Helps You</h3>
                    <ul id="positive-factors" class="mt-4 space-y-3 factor-list"></ul>
                </div>
            </section>
            
            <section id="chart-section" class="content-card p-6 sm:p-8 animate-on-scroll">
                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h2 class="text-2xl sm:text-3xl font-extrabold">Lower Your Biological Age With Our Plan</h2>
                        <p class="mt-4 text-gray-700">Our personalized <span class="font-bold">21-day plan</span> is designed to help you build habits that rejuvenate your body from the inside out. You will see and feel the difference.</p>
                        
                        <div class="mt-6 pt-4 border-t border-gray-200">
                             <h4 class="font-bold text-lg">What's inside the full plan:</h4>
                             <ul class="mt-2 space-y-2 text-gray-600">
                                 <li class="flex items-center gap-2">‚úÖ <span class="font-semibold">Step-by-step daily tasks:</span> Simple and effective actions.</li>
                                 <li class="flex items-center gap-2">‚úÖ <span class="font-semibold">Detailed skin analysis:</span> Learn about hidden factors.</li>
                                 <li class="flex items-center gap-2">‚úÖ <span class="font-semibold">Increase your potential lifespan:</span> Habits that promote longevity.</li>
                             </ul>
                        </div>

                        <a href="#" id="cta-link" class="cta-button pulsating inline-block w-full sm:w-auto text-center font-bold py-4 px-8 rounded-xl mt-6">
                            üöÄ Unlock My Full Plan
                        </a>
                    </div>
                    <div>
                        <canvas id="ageChart"></canvas>
                    </div>
                </div>
            </section>
            
            <section class="animate-on-scroll">
                <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">See What Others Have Achieved</h2>
            
                <div id="testimonial-slider-container" class="relative">
                    <div id="testimonial-slider-wrapper" class="flex overflow-x-auto snap-x snap-mandatory scroll-smooth pb-4">
                        <div class="testimonial-slide">
                            <div class="content-card h-full p-6 flex flex-col justify-between">
                                <div>
                                    <div class="star-rating flex items-center mb-2">
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                    </div>
                                    <p class="text-gray-700 italic">"I was shocked by my biological age. It was the wake-up call I needed. The 21-day plan was so easy to follow and made a real difference in my energy levels."</p>
                                </div>
                                <div class="mt-4 text-right">
                                    <p class="font-bold">- Sarah K.</p>
                                    <p class="text-sm text-gray-500">Lowered bio-age by 3 years</p>
                                </div>
                            </div>
                        </div>
            
                        <div class="testimonial-slide">
                            <div class="content-card h-full p-6 flex flex-col justify-between">
                                <div>
                                    <div class="star-rating flex items-center mb-2">
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                    </div>
                                    <p class="text-gray-700 italic">"I started using the app and immediately felt more in control of my health. My skin looks better and I feel more energized. The detailed profile was the motivation I needed."</p>
                                </div>
                                <div class="mt-4 text-right">
                                    <p class="font-bold">- John S.</p>
                                    <p class="text-sm text-gray-500">Improved sleep quality</p>
                                </div>
                            </div>
                        </div>

                        <div class="testimonial-slide">
                            <div class="content-card h-full p-6 flex flex-col justify-between">
                                <div>
                                    <div class="star-rating flex items-center mb-2">
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                        <svg class="w-5 h-5 text-gray-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                    </div>
                                    <p class="text-gray-700 italic">"I was skeptical at first, but the biological age calculation was spot on. It really motivated me to make healthier choices and the support from the community has been incredible."</p>
                                </div>
                                <div class="mt-4 text-right">
                                    <p class="font-bold">- Jessica M.</p>
                                    <p class="text-sm text-gray-500">More active lifestyle</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="slider-dots"></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loadingOverlay = document.getElementById('loading-overlay');
            const profileContent = document.getElementById('profile-content');
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('sessionId');

            if (!sessionId) {
                loadingOverlay.innerHTML = `<p class="text-lg text-red-600 font-semibold">Error: Session ID not found.</p>`;
                return;
            }

            const API_ENDPOINT = '/.netlify/functions/getProfileData';

            async function fetchProfileData() {
                try {
                    const response = await fetch(API_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sessionId: sessionId })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    updateUI(data);

                } catch (error) {
                    console.error('Failed to fetch profile data:', error);
                    loadingOverlay.innerHTML = `<p class="text-lg text-red-600 font-semibold">Failed to load profile. Please try again later.</p>`;
                }
            }

            function updateUI(data) {
                // Update basic stats
                document.getElementById('chrono-age').textContent = data.chronoAge;
                document.getElementById('bio-age').textContent = data.bioAgeResult.bioAge;
                document.getElementById('age-summary-text').textContent = data.bioAgeResult.summary;
                document.getElementById('archetype-name').textContent = data.wellnessArchetype.name;
                document.getElementById('archetype-desc').textContent = data.wellnessArchetype.description;
                document.getElementById('focus-area-name').textContent = data.focusArea.name;
                document.getElementById('focus-area-desc').textContent = data.focusArea.description;

                // Update user photo
                const userPhoto = document.getElementById('user-photo');
                if (data.userPhotoUrl) {
                    userPhoto.src = data.userPhotoUrl;
                    userPhoto.onerror = () => {
                        userPhoto.src = "https://placehold.co/400x533/f5f2ef/3c3b31?text=Image+Unavailable";
                    };
                }

                populateFactors('negative', data.factors.negative, document.getElementById('negative-factors'));
                populateFactors('positive', data.factors.positive, document.getElementById('positive-factors'));
                populateBmiWidget(data.bmi.value, data.gender);
                
                // New: Populate skin analysis
                if (data.skinStatus) {
                    populateSkinAnalysis(data.skinStatus);
                } else {
                    document.getElementById('skin-analysis-container').innerHTML = `<h3 class="text-xl font-bold mb-4" style="color: var(--brand-dark-text);">Skin Analysis</h3><p class="text-gray-500">No skin analysis data available.</p>`;
                }
                
                initChart(data.chronoAge, data.bioAgeResult.bioAge);

                // Hide loading overlay and show content
                loadingOverlay.style.opacity = '0';
                loadingOverlay.style.pointerEvents = 'none';
                profileContent.style.opacity = '1';

                initScrollAnimations();
                initTestimonialSlider();
            }

            function populateFactors(type, factors, listElement) {
                listElement.innerHTML = '';
                if (factors.length === 0) {
                    listElement.innerHTML = `<li class="text-gray-500">No data found.</li>`;
                    return;
                }
                factors.forEach(factor => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('animate-on-scroll');
                    listItem.innerHTML = `
                        <span class="text-2xl mr-3">${factor.icon}</span>
                        <div>
                            <p class="font-bold">${factor.text}</p>
                            <p class="text-sm text-gray-500 mt-0.5">${factor.detail}</p>
                        </div>
                    `;
                    listElement.appendChild(listItem);
                });
            }

            function populateSkinAnalysis(skinStatus) {
                const listElement = document.getElementById('skin-analysis-list');
                listElement.innerHTML = '';

                const metrics = {
                    oiliness: { label: 'Oiliness', color: 'bg-yellow-400' },
                    pigment: { label: 'Pigment', color: 'bg-yellow-600' },
                    dark_circle: { label: 'Dark Circles', color: 'bg-blue-800' }
                };

                for (const key in metrics) {
                    if (skinStatus.hasOwnProperty(key)) {
                        const value = skinStatus[key].value;
                        const score = Math.min(100, Math.max(0, value));
                        const li = document.createElement('li');
                        li.classList.add('animate-on-scroll');
                        li.innerHTML = `
                            <div class="flex justify-between items-center mb-1">
                                <span class="skin-metric-label">${metrics[key].label}</span>
                                <span class="font-bold">${score}%</span>
                            </div>
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fg ${metrics[key].color}" style="width: ${score}%;"></div>
                            </div>
                        `;
                        listElement.appendChild(li);
                    }
                }
            }

            function populateBmiWidget(bmiValue, gender) {
                const bmiCategory = document.getElementById('bmi-category');
                const bmiDescription = document.getElementById('bmi-description');
                const bmiThumb = document.getElementById('bmi-thumb');
                const bmiImage = document.getElementById('bmi-image');
                const bmiValueEl = document.getElementById('bmi-value');
                const thumbPos = Math.min(1, Math.max(0, (bmiValue - 15) / (35 - 15)));

                let category = '';
                let description = '';
                let categoryColor = '';
                let imageUrl = '';

                if (gender === 'male') {
                    if (bmiValue < 18.5) { category = 'Underweight'; description = 'Your BMI is below the healthy range. Consider a plan to gain weight safely.'; categoryColor = 'text-blue-500'; imageUrl = `https://placehold.co/120x150/f9f7f5/3c3b31?text=Thin+Male`; }
                    else if (bmiValue < 25) { category = 'Healthy Weight'; description = 'Congratulations! Your BMI is within the healthy range. Keep up the good work.'; categoryColor = 'text-green-600'; imageUrl = `https://placehold.co/120x150/f9f7f5/3c3b31?text=Healthy+Male`; }
                    else if (bmiValue < 30) { category = 'Overweight'; description = 'Your BMI suggests you are overweight. A healthy diet and exercise can help.'; categoryColor = 'text-yellow-500'; imageUrl = `https://placehold.co/120x150/f9f7f5/3c3b31?text=Overweight+Male`; }
                    else { category = 'Obese'; description = 'Your BMI is in the obese range. This can impact your health. Consider consulting a professional.'; categoryColor = 'text-red-500'; imageUrl = `https://placehold.co/120x150/f9f7f5/3c3b31?text=Obese+Male`; }
                } else { // female
                    if (bmiValue < 18.5) { category = 'Underweight'; description = 'Your BMI is below the healthy range. Consider a plan to gain weight safely.'; categoryColor = 'text-blue-500'; imageUrl = `https://placehold.co/120x150/f9f7f5/3c3b31?text=Thin+Female`; }
                    else if (bmiValue < 25) { category = 'Healthy Weight'; description = 'Congratulations! Your BMI is within the healthy range. Keep up the good work.'; categoryColor = 'text-green-600'; imageUrl = `https://placehold.co/120x150/f9f7f5/3c3b31?text=Healthy+Female`; }
                    else if (bmiValue < 30) { category = 'Overweight'; description = 'Your BMI suggests you are overweight. A healthy diet and exercise can help.'; categoryColor = 'text-yellow-500'; imageUrl = `https://placehold.co/120x150/f9f7f5/3c3b31?text=Overweight+Female`; }
                    else { category = 'Obese'; description = 'Your BMI is in the obese range. This can impact your health. Consider consulting a professional.'; categoryColor = 'text-red-500'; imageUrl = `https://placehold.co/120x150/f9f7f5/3c3b31?text=Obese+Female`; }
                }
                
                bmiValueEl.textContent = `BMI: ${bmiValue}`;
                bmiCategory.textContent = category;
                bmiCategory.className = `font-bold text-lg -mt-1 ${categoryColor}`;
                bmiDescription.textContent = description;
                bmiImage.src = imageUrl;

                // Animate thumb
                requestAnimationFrame(() => {
                    bmiThumb.style.bottom = `${thumbPos * 100}%`;
                });
            }

            function initChart(chronoAge, bioAge) {
                const ctx = document.getElementById('ageChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Your Bio Age', 'Your Chrono Age'],
                        datasets: [
                            {
                                label: 'Your Ages',
                                data: [bioAge, chronoAge],
                                backgroundColor: [
                                    'rgba(222, 190, 169, 0.8)',
                                    'rgba(60, 59, 49, 0.8)'
                                ],
                                borderColor: [
                                    '#debea9',
                                    '#3c3b31'
                                ],
                                borderWidth: 1,
                                borderRadius: 8,
                                barPercentage: 0.6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    title: (context) => context[0].label,
                                    label: (context) => `Age: ${context.raw}`
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { display: false },
                                ticks: { display: false },
                                border: { display: false }
                            },
                            x: {
                                grid: { display: false },
                                border: { display: false },
                                ticks: {
                                    font: { family: 'Inter', weight: 'bold' }
                                }
                            }
                        }
                    }
                });
            }

            function initScrollAnimations() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                            observer.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.2, rootMargin: "0px 0px -50px 0px" });

                document.querySelectorAll('.animate-on-scroll').forEach(element => {
                    observer.observe(element);
                });
            }
            
            function initTestimonialSlider() {
                const slider = document.getElementById('testimonial-slider-wrapper');
                const slides = slider.querySelectorAll('.testimonial-slide');
                const dotsContainer = document.querySelector('.slider-dots');
                let currentSlide = 0;

                // Create dots
                slides.forEach((_, index) => {
                    const dot = document.createElement('div');
                    dot.classList.add('slider-dot');
                    dot.addEventListener('click', () => {
                        slider.scrollTo({
                            left: slider.offsetWidth * index,
                            behavior: 'smooth'
                        });
                    });
                    dotsContainer.appendChild(dot);
                });

                // Update active dot on scroll
                slider.addEventListener('scroll', () => {
                    const newIndex = Math.round(slider.scrollLeft / slider.offsetWidth);
                    if (newIndex !== currentSlide) {
                        currentSlide = newIndex;
                        updateDots();
                    }
                });

                function updateDots() {
                    const dots = dotsContainer.querySelectorAll('.slider-dot');
                    dots.forEach((dot, index) => {
                        dot.classList.toggle('active', index === currentSlide);
                    });
                }
                
                updateDots(); // Initial update
            }

            fetchProfileData();
        });
    </script>
</body>
</html>

