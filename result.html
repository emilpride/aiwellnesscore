<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Your AI WELLNESSCORE Report</title>
    <meta name="description" content="Your personalized AI-powered wellness report, including your Wellness Age, detailed metrics, skin analysis, and a 7-day improvement plan.">
    <meta name="robots" content="noindex, nofollow">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßò</text></svg>">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <style>
        body { font-family: 'Inter', sans-serif; }
        .reveal {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 0.8s cubic-bezier(0.165, 0.84, 0.44, 1), transform 0.8s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .reveal.active { opacity: 1; transform: translateY(0); }

        #loading-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            flex-direction: column;
            transition: opacity 0.5s ease-out;
        }
        .spinner {
            width: 56px;
            height: 56px;
            border: 5px solid #d1d5db;
            border-bottom-color: #6366f1;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media print {
            body { 
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact; 
                background-color: #ffffff !important;
            }
            .no-print { display: none !important; }
            .report-container, section { 
                box-shadow: none !important; 
                border: none !important; 
                padding: 0 !important;
            }
            html, body {
                width: 100%;
                height: auto;
                background: none;
            }
            main {
                padding: 0 !important;
            }
            .fixed.z-[-1] {
                display: none;
            }
            section {
                page-break-before: always;
                page-break-inside: avoid;
            }
            section.report-container {
                page-break-before: auto;
            }
            .grid > div, .space-y-3 > li {
                page-break-inside: avoid;
            }
        }
    </style>
    <script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '785592354117222');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=785592354117222&ev=PageView&noscript=1"
/></noscript>
</head>
<body class="bg-gray-50 text-gray-900 antialiased">
    <div id="loading-overlay">
        <div class="spinner"></div>
        <h2 id="loading-text" class="text-xl font-semibold text-gray-700 mt-6">We are preparing your personal report...</h2>
<p class="text-gray-500 mt-2">This may take up to 20 seconds.</p>
    </div>
    
    <div class="relative overflow-hidden">
        <div class="fixed -top-1/4 -left-32 w-[60rem] h-[60rem] bg-cyan-200 rounded-full mix-blend-multiply filter blur-3xl opacity-40 z-[-1] animate-pulse"></div>
        <div class="fixed -bottom-1/4 -right-32 w-[55rem] h-[55rem] bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-40 z-[-1] animate-pulse" style="animation-delay: 2s;"></div>
        
        <header class="sticky top-0 z-50 bg-white/60 backdrop-blur-xl border-b border-white/20 no-print">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <a href="index.html" class="flex items-center">
                    <img src="logo.png" alt="AI WELLNESSCORE Logo" class="h-10">
                </a>
                <div class="flex items-center gap-4">
                    <button class="download-pdf-btn bg-purple-600 text-white font-semibold px-5 py-2 rounded-full text-sm sm:text-base hover:bg-purple-700 transition-colors">
                        Download PDF
                    </button>
                </div>
            </div>
        </header>

        <main class="relative z-10">
            <div id="report-content" class="container mx-auto px-6 py-12 md:py-20" style="visibility: hidden;">
                
                <section class="text-center report-container bg-white p-8 md:p-12 rounded-3xl shadow-2xl border border-gray-200 reveal">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Your Personalized Wellness Report</h1>
                    <p class="text-lg text-gray-600 mt-4">Hi <span id="user-name"></span>, here are the results from your analysis.</p>

                    <div class="grid md:grid-cols-2 gap-8 items-center mt-8 text-left">
                        <div class="bg-gray-50 p-6 rounded-2xl text-center">
                            <p class="text-lg text-gray-600">Your chronological age is</p>
                            <p class="text-6xl md:text-7xl font-extrabold text-gray-800" id="chrono-age"></p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-2xl text-center">
                             <p class="text-lg text-purple-800">Your wellness age is</p>
                             <p class="text-6xl md:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-500" id="wellness-age"></p>
                        </div>
                    </div>
                     <div class="mt-8 bg-green-50 border border-green-200 text-green-800 p-5 rounded-xl text-center">
                        <p>By implementing the recommended habits, you could lower your biological age by another <strong id="age-reduction-prediction"></strong> in just one month.</p>
                    </div>
                </section>
                
                <section id="gauge-section" class="mt-12 text-center bg-white p-8 md:p-12 rounded-3xl shadow-xl border border-gray-200 reveal">
                    <h2 class="text-3xl font-bold text-center">Overall Wellness Score</h2>
                    <div class="relative w-full max-w-[280px] mx-auto mt-4">
                        <canvas id="wellnessGauge"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center">
                             <div class="text-center">
                                <span id="gauge-score" class="text-5xl font-extrabold">0</span>
                                <p class="font-semibold text-gray-600">out of 100</p>
                            </div>
                        </div>
                    </div>
                    <p id="wellness-score-desc" class="mt-4 text-gray-600 max-w-xl mx-auto"></p>
                </section>

                <section class="mt-12 grid md:grid-cols-2 gap-8 reveal" style="transition-delay: 0.2s;">
                    <div class="bg-white p-8 rounded-2xl border border-gray-200">
                        <div class="flex items-center gap-3">
                            <svg class="h-8 w-8 text-red-500"  fill="none" viewBox="0 0 24 24" stroke="currentColor">
                               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"/>
                            </svg>
                            <h3 class="text-2xl font-bold text-red-600">What's Increasing Your Age?</h3>
                        </div>
                         <ul id="increasing-factors" class="mt-4 space-y-3 text-gray-700"></ul>
                    </div>
                     <div class="bg-white p-8 rounded-2xl border border-gray-200">
                          <div class="flex items-center gap-3">
                             <svg class="h-8 w-8 text-green-500"  fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                            </svg>
                            <h3 class="text-2xl font-bold text-green-600">What's Decreasing Your Age?</h3>
                        </div>
                        <ul id="decreasing-factors" class="mt-4 space-y-3 text-gray-700"></ul>
                    </div>
                </section>

                <section id="charts-section" class="mt-12 bg-white p-8 md:p-12 rounded-3xl border border-gray-200 reveal" style="transition-delay: 0.4s;">
                    <h2 class="text-3xl font-bold text-center">Detailed Metrics Breakdown</h2>
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div class="text-center p-6 bg-gray-50 rounded-2xl">
                            <h4 class="text-lg font-bold">Energy</h4>
                            <div class="relative h-36 w-36 mx-auto mt-2">
                                <canvas id="energyChart"></canvas>
                            </div>
                            <p id="energy-desc" class="mt-3 text-sm text-gray-600"></p>
                        </div>
                        <div class="text-center p-6 bg-gray-50 rounded-2xl">
                             <h4 class="text-lg font-bold">Stress</h4>
                             <div class="relative h-36 w-36 mx-auto mt-2">
                                <canvas id="stressChart"></canvas>
                             </div>
                            <p id="stress-desc" class="mt-3 text-sm text-gray-600"></p>
                        </div>
                        <div class="text-center p-6 bg-gray-50 rounded-2xl">
                            <h4 class="text-lg font-bold">Skin Quality</h4>
                            <div class="relative h-36 w-36 mx-auto mt-2">
                                <canvas id="skinChart"></canvas>
                            </div>
                            <p id="skin-quality-desc" class="mt-3 text-sm text-gray-600"></p>
                        </div>
                        <div class="p-6 bg-gray-50 rounded-2xl flex items-center gap-4"><div class="text-3xl">‚öñÔ∏è</div><div><h4 id="bmi-value" class="font-bold"></h4><p id="bmi-desc" class="text-sm text-gray-600"></p></div></div>
                        <div class="p-6 bg-gray-50 rounded-2xl flex items-center gap-4"><div class="text-3xl">ü•ó</div><div><h4 id="nutrition-value" class="font-bold"></h4><p id="nutrition-desc" class="text-sm text-gray-600"></p></div></div>
                        <div class="p-6 bg-gray-50 rounded-2xl flex items-center gap-4"><div class="text-3xl">üèÉ‚Äç‚ôÄÔ∏è</div><div><h4 id="habits-value" class="font-bold"></h4><p id="habits-desc" class="text-sm text-gray-600"></p></div></div>
                    </div>
                </section>
                
                <section class="mt-12 bg-white p-8 md:p-12 rounded-3xl border border-gray-200 reveal">
                     <h2 class="text-3xl font-bold text-center">Skin Analysis</h2>
                    <div class="mt-8 max-w-4xl mx-auto">
                        <div id="skin-analysis-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        </div>
                         <div class="mt-8 bg-purple-50 p-6 rounded-xl border border-purple-200">
                            <h4 class="font-bold text-lg text-purple-800">Skin Condition Conclusion:</h4>
                            <p id="skin-conclusion" class="mt-2 text-gray-700"></p>
                         </div>
                    </div>
                </section>

                <section class="mt-12 bg-gradient-to-br from-purple-600 to-indigo-700 text-white p-8 md:p-12 rounded-3xl reveal">
                    <h2 class="text-3xl font-bold text-center">Your 7-Day Improvement Plan</h2>
                    <p class="text-center mt-2 text-purple-200">Start with these small, actionable steps.</p>
                    <div id="seven-day-plan-grid" class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
                </section>

                <section class="mt-16 text-center reveal no-print">
                    <button class="download-pdf-btn bg-purple-600 text-white font-semibold px-8 py-4 rounded-full text-lg hover:bg-purple-700 transition-colors transform hover:scale-105">
                        Download Your Report as PDF
                    </button>
                </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function() {

            async function fetchWellnessData() {
                const params = new URLSearchParams(window.location.search);
                const sessionId = params.get('session_id');

                if (!sessionId) {
                    throw new Error("Session ID is missing. Please complete the quiz first.");
                }

                const checkStatus = async () => {
                    const response = await fetch('/.netlify/functions/checkResult', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ sessionId: sessionId })
                    });
                    if (!response.ok) {
                        throw new Error('Server error while checking report status.');
                    }
                    return response.json();
                };

                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 10; // ~30 —Å–µ–∫—É–Ω–¥
                    const intervalId = setInterval(async () => {
                        attempts++;
                        try {
                            const result = await checkStatus();
                            if (result.status === 'complete') {
                                clearInterval(intervalId);
                                resolve(result.data);
                            } else if (result.status === 'error') {
                                clearInterval(intervalId);
                                reject(new Error(result.message));
                            } else if (attempts >= maxAttempts) {
                                clearInterval(intervalId);
                                reject(new Error("Report generation timed out."));
                            }
                        } catch (error) {
                            clearInterval(intervalId);
                            reject(error);
                        }
                    }, 3000);
                });
            }
            
            function populateReport(data) {
                document.getElementById('report-content').style.visibility = 'visible';
                document.getElementById('user-name').textContent = data.userName;
                document.getElementById('chrono-age').textContent = data.chronoAge;
                document.getElementById('wellness-age').textContent = data.wellnessAge;
                document.getElementById('age-reduction-prediction').textContent = data.ageReductionPrediction;
                document.getElementById('wellness-score-desc').textContent = data.metrics.wellnessScore.description;
                const populateList = (elementId, items) => {
                    const list = document.getElementById(elementId);
                    list.innerHTML = '';
                    items.forEach(item => {
                        const li = document.createElement('li');
                        const icon = elementId === 'increasing-factors' ? '‚Üí' : '‚Üí';
                        const iconColor = elementId === 'increasing-factors' ? 'text-red-500' : 'text-green-500';
                        li.className = 'flex items-start';
                        li.innerHTML = `<span class="mr-2 ${iconColor}">${icon}</span><span>${item}</span>`;
                        list.appendChild(li);
                    });
                };
                populateList('increasing-factors', data.increasingFactors);
                populateList('decreasing-factors', data.decreasingFactors);

                document.getElementById('energy-desc').textContent = data.metrics.energy.description;
                document.getElementById('stress-desc').textContent = data.metrics.stress.description;
                document.getElementById('skin-quality-desc').textContent = data.metrics.skinQuality.description;
                document.getElementById('bmi-value').textContent = `BMI: ${data.metrics.bmi.value}`;
                document.getElementById('bmi-desc').textContent = data.metrics.bmi.description;
                document.getElementById('nutrition-value').textContent = `Nutrition: ${data.metrics.nutrition.value}`;
                document.getElementById('nutrition-desc').textContent = data.metrics.nutrition.description;
                document.getElementById('habits-value').textContent = `Healthy Habits: ${data.metrics.healthyHabits.value}`;
                document.getElementById('habits-desc').textContent = data.metrics.healthyHabits.description;
                
                populateSkinAnalysis(data.skinAnalysis);
                document.getElementById('skin-conclusion').textContent = data.skinAnalysis.conclusion;

                populateSevenDayPlan(data.sevenDayPlan);
            }
            
            function populateSkinAnalysis(skinData) {
                const grid = document.getElementById('skin-analysis-grid');
                grid.innerHTML = '';
                
                const skinMap = {
                    dark_circle: { icon: 'üëÅÔ∏è', title: 'Dark Circles', desc: 'A sign of fatigue or stress.' },
                    eye_pouch: { icon: 'üëú', title: 'Under-Eye Bags', desc: 'Reflects tiredness or fluid retention.' },
                    forehead_wrinkle: { icon: '„Ä∞Ô∏è', title: 'Forehead Wrinkles', desc: 'Linked to expressions and aging.' },
                    glabella_wrinkle: { icon: 'üò†', title: 'Frown Lines', desc: 'Can appear from tension or stress.' },
                    nasolabial_fold: { icon: 'üòä', title: 'Smile Lines', desc: 'A natural result of smiling and aging.' },
                    eye_finelines: { icon: '‚ú®', title: 'Fine Lines', desc: 'Often from squinting or dehydration.' },
                    crows_feet: { icon: 'üê¶', title: "Crow's Feet", desc: "Linked to smiling and sun exposure." },
                    skin_spot: { icon: 'üü§', title: 'Skin Spots', desc: 'Caused by sun exposure or hormones.' },
                    acne: { icon: 'üî¥', title: 'Acne', desc: 'Influenced by hormones, diet, or stress.' },
                    blackhead: { icon: '‚ö´', title: 'Blackheads', desc: 'Clogged pores with oil and skin cells.' },
                    pores: { icon: 'üï≥Ô∏è', title: 'Visible Pores', desc: 'Result from excess oil or genetics.' },
                    mole: { icon: '‚ö´', title: 'Moles', desc: 'Typically harmless pigmented spots.' }
                };
                for (const key in skinData) {
                    if (skinData[key] === 1 && skinMap[key]) {
                        const item = skinMap[key];
                        const div = document.createElement('div');
                        div.className = 'flex items-start space-x-3 p-4 bg-gray-50 rounded-lg';
                        div.innerHTML = `<span class="text-xl">${item.icon}</span><div><h4 class="font-bold">${item.title}</h4><p class="text-sm text-gray-600">${item.desc}</p></div>`;
                        grid.appendChild(div);
                    }
                }
                const skinTypes = ['Oily Skin', 'Dry Skin', 'Normal Skin', 'Mixed Skin'];
                const skinTypeDescriptions = ['Oily T-zone, shiny appearance.', 'Can feel tight, flaky, or rough.', 'Balanced with minimal imperfections.', 'Oily T-zone and dry cheeks.'];
                const typeIndex = skinData.skin_type;
                if (typeIndex !== undefined && skinTypes[typeIndex]) {
                     const div = document.createElement('div');
                     div.className = 'flex items-start space-x-3 p-4 bg-gray-50 rounded-lg';
                     div.innerHTML = `<span class="text-xl">üé≠</span><div><h4 class="font-bold">Skin Type: ${skinTypes[typeIndex]}</h4><p class="text-sm text-gray-600">${skinTypeDescriptions[typeIndex]}</p></div>`;
                     grid.appendChild(div);
                }
            }

            function populateSevenDayPlan(planData) {
                const grid = document.getElementById('seven-day-plan-grid');
                grid.innerHTML = '';
                planData.forEach(day => {
                    const div = document.createElement('div');
                    div.className = 'bg-white/10 p-5 rounded-lg flex items-start gap-4';
                    div.innerHTML = `<div class="text-3xl mt-1">${day.icon}</div><div><b class="block text-lg">Day ${day.day}: ${day.title}</b><p class="text-sm opacity-80">${day.task}</p></div>`;
                    grid.appendChild(div);
                });
            }

            let chartData = {};
            function getScoreColor(value) {
                if (value >= 75) return '#22c55e';
                if (value >= 50) return '#f59e0b';
                return '#ef4444';
            }
            
            function animateValue(obj, start, end, duration) {
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    obj.innerHTML = Math.floor(progress * (end - start) + start);
                    if (progress < 1) { window.requestAnimationFrame(step); } else { obj.innerHTML = end; }
                };
                window.requestAnimationFrame(step);
            }

            const donutChartOptions = (data, color) => ({
                type: 'doughnut',
                data: { datasets: [{ data: [data, 100 - data], backgroundColor: [color, '#e5e7eb'], borderColor: ['#ffffff'], borderWidth: 2, circumference: 180, rotation: 270, }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '80%', plugins: { legend: { display: false }, tooltip: { enabled: false }, }, animation: { duration: 1500, easing: 'easeOutQuart' } }
            });

            const createTextPlugin = (text) => ({
                id: 'centerText',
                beforeDraw: function(chart) {
                    const {width, height, ctx} = chart;
                    ctx.restore();
                    const fontSize = (height / 80).toFixed(2);
                    ctx.font = `bold ${fontSize}em Inter, sans-serif`;
                    ctx.textBaseline = "middle";
                    const textX = Math.round((width - ctx.measureText(text).width) / 2);
                    const textY = height / 1.5;
                    ctx.fillStyle = '#1f2937';
                    ctx.fillText(text, textX, textY);
                    ctx.save();
                }
            });

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');
                        if (entry.target.id === 'gauge-section') renderGaugeChart();
                        if (entry.target.id === 'charts-section') renderDetailedCharts();
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.3 });

            document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

            function renderGaugeChart() {
                const wellnessGaugeCtx = document.getElementById('wellnessGauge')?.getContext('2d');
                if (wellnessGaugeCtx) {
                    const score = chartData.metrics.wellnessScore.value;
                    const scoreColor = getScoreColor(score);
                    new Chart(wellnessGaugeCtx, donutChartOptions(score, scoreColor));
                    const gaugeScoreEl = document.getElementById('gauge-score');
                    gaugeScoreEl.style.color = scoreColor;
                    animateValue(gaugeScoreEl, 0, score, 1500);
                }
            }

            function renderDetailedCharts() {
                const energyCtx = document.getElementById('energyChart')?.getContext('2d');
                if(energyCtx) new Chart(energyCtx, { ...donutChartOptions(chartData.metrics.energy.value, getScoreColor(chartData.metrics.energy.value)), plugins: [createTextPlugin(`${chartData.metrics.energy.value}%`)] });

                const stressScore = chartData.metrics.stress.value;
                const stressColor = stressScore > 70 ? '#ef4444' : stressScore > 50 ? '#f59e0b' : '#22c55e';
                const stressCtx = document.getElementById('stressChart')?.getContext('2d');
                if(stressCtx) new Chart(stressCtx, { ...donutChartOptions(stressScore, stressColor), plugins: [createTextPlugin(`${stressScore}%`)] });

                const skinCtx = document.getElementById('skinChart')?.getContext('2d');
                if(skinCtx) new Chart(skinCtx, { ...donutChartOptions(chartData.metrics.skinQuality.value, getScoreColor(chartData.metrics.skinQuality.value)), plugins: [createTextPlugin(`${chartData.metrics.skinQuality.value}%`)] });
            }

            const downloadButtons = document.querySelectorAll('.download-pdf-btn');
            downloadButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const element = document.getElementById('report-content');
                    const opt = {
                        margin: 0.5,
                        filename: 'AI-WELLNESSCORE-Report.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2, useCORS: true },
                        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
                        pagebreak: { 
                            mode: ['css', 'avoid-all'],
                            before: ['#gauge-section', '#charts-section', '.mt-12.bg-white', '.mt-12.bg-gradient-to-br']
                        }
                    };
                    html2pdf().set(opt).from(element).save();
                });
            });

            async function initializeReport() {
                const params = new URLSearchParams(window.location.search);
                if (params.get('payment') === 'success') {
                    fbq('track', 'Purchase', {value: 9.99, currency: 'USD'});
                }

                const loadingOverlay = document.getElementById('loading-overlay');
                const loadingText = document.getElementById('loading-text');
                try {
                    const reportData = await fetchWellnessData();
                    chartData = reportData; 
                    populateReport(reportData);
                    loadingOverlay.style.opacity = 0;
                    setTimeout(() => { loadingOverlay.style.display = 'none'; }, 500);
                } catch (error) {
                    console.error("Failed to get report:", error);
                    loadingText.textContent = `Error: ${error.message}`;
                    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ –∏–ª–∏ —Å–≤—è–∑–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
                }
            }

            initializeReport();
        });
    </script>
</body>
</html>
