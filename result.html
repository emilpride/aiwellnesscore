<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your AI WELLNESSCORE Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; overflow-x: hidden; background-color: #0f172a; }
        .gradient-bg-dark-animated { background: linear-gradient(300deg, #0f172a, #1e1b4b, #312e81, #0f172a); background-size: 200% 200%; animation: slow-pan 25s ease infinite; }
        @keyframes slow-pan { 0% { background-position: 0% 0%; } 25% { background-position: 100% 0%; } 50% { background-position: 100% 100%; } 75% { background-position: 0% 100%; } 100% { background-position: 0% 0%; } }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .score-circle-path { transition: stroke-dasharray 2s ease-out; }
    </style>
</head>
<body class="bg-slate-900 text-gray-200">

    <div class="gradient-bg-dark-animated min-h-screen py-8">
        <div class="max-w-md mx-auto px-4 space-y-12">

            <section class="text-center">
                <span class="text-teal-300 text-sm font-medium px-4 py-1.5 rounded-full bg-teal-900/50 border border-teal-800">Your Wellness Archetype</span>
                <h1 data-report="archetype" class="text-4xl font-black text-white mt-3 tracking-tight">Loading...</h1>
                <p data-report="archetypeDescription" class="text-base text-gray-400 mt-2 mx-auto max-w-sm">Analyzing your results...</p>
            </section>

            <section class="text-center">
                <div class="relative w-56 h-56 mx-auto">
                    <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                        <defs>
                            <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#14E3E3; stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#4F46E5; stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <path class="text-slate-700" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke-width="2" />
                        <path id="score-circle-path" class="score-circle-path" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke-width="2" stroke="url(#scoreGradient)" stroke-linecap="round" />
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span class="text-6xl font-black text-white" id="score-text">0</span>
                        <span class="text-lg text-gray-400">Overall Score</span>
                    </div>
                </div>
            </section>
            
            <section class="glass-card p-6 rounded-xl text-center">
                <h3 class="text-xl font-bold text-white mb-2">Key AI Insight</h3>
                <p data-report="keyInsight" class="text-sm text-gray-300">Loading insight...</p>
            </section>
            
            <section class="glass-card p-4 rounded-lg text-center">
               <h3 class="font-semibold text-white text-lg">Full Photo Analysis</h3>
               <p class="text-sm text-gray-400 mt-2" data-premium-id="fullPhotoAnalysis">Unlock the premium report to see this.</p>
            </section>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        const scoreTextEl = document.getElementById('score-text');
        const scoreCircleEl = document.getElementById('score-circle-path');

        function animateScore(totalScore) {
            let currentScore = 0;
            const interval = setInterval(() => {
                if (currentScore >= totalScore) {
                    clearInterval(interval);
                    scoreTextEl.textContent = totalScore;
                } else {
                    currentScore++;
                    scoreTextEl.textContent = currentScore;
                }
            }, 25);
        }

        function animateScoreCircle(totalScore) {
            if (!scoreCircleEl) return;
            const circumference = 2 * Math.PI * 15.9155;
            const offset = (totalScore / 100) * circumference;
            scoreCircleEl.style.strokeDasharray = `0 ${circumference}`;
            setTimeout(() => {
                scoreCircleEl.style.strokeDasharray = `${offset} ${circumference}`;
            }, 100);
        }

        async function fetchAndRenderReport() {
            const params = new URLSearchParams(window.location.search);
            const sessionId = params.get('sessionId');

            if (!sessionId) {
                document.body.innerHTML = `<div class="text-center p-8 text-red-400"><h1>Error</h1><p>Session ID not found.</p></div>`;
                return;
            }

            try {
                const response = await fetch('/.netlify/functions/result', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sessionId })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Server error: ${errorText}`);
                }
                
                const reportData = await response.json();
                const freeData = reportData.freeReport;

                if (!freeData) {
                    throw new Error("AI response is missing freeReport data.");
                }

                // Populate all text fields from the report
                document.querySelector('[data-report="archetype"]').textContent = freeData.archetype || 'N/A';
                document.querySelector('[data-report="archetypeDescription"]').textContent = freeData.archetypeDescription || '...';
                document.querySelector('[data-report="keyInsight"]').innerHTML = freeData.keyInsight || '...';
                
                const wellnessScore = freeData.wellnessScore || 0;
                
                // Initialize animations
                animateScore(wellnessScore);
                animateScoreCircle(wellnessScore);

            } catch (error) {
                console.error('Failed to fetch or render report:', error);
                document.body.innerHTML = `<div class="text-center p-8 text-red-400"><h1>Analysis Failed</h1><p>${error.message}</p></div>`;
            }
        }

        fetchAndRenderReport();
    });
    </script>
</body>
</html>
